{"code":"import JSBI from 'jsbi';\r\nimport invariant from 'tiny-invariant';\r\nimport { ZERO } from '../internalConstants';\r\nimport { isSorted } from './isSorted';\r\nfunction tickComparator(a, b) {\r\n    return a.index - b.index;\r\n}\r\n/**\r\n * Utility methods for interacting with sorted lists of ticks\r\n */\r\nexport class TickList {\r\n    /**\r\n     * Cannot be constructed\r\n     */\r\n    constructor() { }\r\n    static validateList(ticks, tickSpacing) {\r\n        invariant(tickSpacing > 0, 'TICK_SPACING_NONZERO');\r\n        // ensure ticks are spaced appropriately\r\n        invariant(ticks.every(({ index }) => index % tickSpacing === 0), 'TICK_SPACING');\r\n        // ensure tick liquidity deltas sum to 0\r\n        invariant(JSBI.equal(ticks.reduce((accumulator, { liquidityNet }) => JSBI.add(accumulator, liquidityNet), ZERO), ZERO), 'ZERO_NET');\r\n        invariant(isSorted(ticks, tickComparator), 'SORTED');\r\n    }\r\n    static isBelowSmallest(ticks, tick) {\r\n        invariant(ticks.length > 0, 'LENGTH');\r\n        return tick < ticks[0].index;\r\n    }\r\n    static isAtOrAboveLargest(ticks, tick) {\r\n        invariant(ticks.length > 0, 'LENGTH');\r\n        return tick >= ticks[ticks.length - 1].index;\r\n    }\r\n    static getTick(ticks, index) {\r\n        const tick = ticks[this.binarySearch(ticks, index)];\r\n        invariant(tick.index === index, 'NOT_CONTAINED');\r\n        return tick;\r\n    }\r\n    /**\r\n     * Finds the largest tick in the list of ticks that is less than or equal to tick\r\n     * @param ticks list of ticks\r\n     * @param tick tick to find the largest tick that is less than or equal to tick\r\n     * @private\r\n     */\r\n    static binarySearch(ticks, tick) {\r\n        invariant(!this.isBelowSmallest(ticks, tick), 'BELOW_SMALLEST');\r\n        let l = 0;\r\n        let r = ticks.length - 1;\r\n        let i;\r\n        while (true) {\r\n            i = Math.floor((l + r) / 2);\r\n            if (ticks[i].index <= tick && (i === ticks.length - 1 || ticks[i + 1].index > tick)) {\r\n                return i;\r\n            }\r\n            if (ticks[i].index < tick) {\r\n                l = i + 1;\r\n            }\r\n            else {\r\n                r = i - 1;\r\n            }\r\n        }\r\n    }\r\n    static nextInitializedTick(ticks, tick, lte) {\r\n        if (lte) {\r\n            invariant(!TickList.isBelowSmallest(ticks, tick), 'BELOW_SMALLEST');\r\n            if (TickList.isAtOrAboveLargest(ticks, tick)) {\r\n                return ticks[ticks.length - 1];\r\n            }\r\n            const index = this.binarySearch(ticks, tick);\r\n            return ticks[index];\r\n        }\r\n        else {\r\n            invariant(!this.isAtOrAboveLargest(ticks, tick), 'AT_OR_ABOVE_LARGEST');\r\n            if (this.isBelowSmallest(ticks, tick)) {\r\n                return ticks[0];\r\n            }\r\n            const index = this.binarySearch(ticks, tick);\r\n            return ticks[index + 1];\r\n        }\r\n    }\r\n    static nextInitializedTickWithinOneWord(ticks, tick, lte, tickSpacing) {\r\n        const compressed = Math.floor(tick / tickSpacing); // matches rounding in the code\r\n        if (lte) {\r\n            const wordPos = compressed >> 8;\r\n            const minimum = (wordPos << 8) * tickSpacing;\r\n            if (TickList.isBelowSmallest(ticks, tick)) {\r\n                return [minimum, false];\r\n            }\r\n            const index = TickList.nextInitializedTick(ticks, tick, lte).index;\r\n            const nextInitializedTick = Math.max(minimum, index);\r\n            return [nextInitializedTick, nextInitializedTick === index];\r\n        }\r\n        else {\r\n            const wordPos = (compressed + 1) >> 8;\r\n            const maximum = (((wordPos + 1) << 8) - 1) * tickSpacing;\r\n            if (this.isAtOrAboveLargest(ticks, tick)) {\r\n                return [maximum, false];\r\n            }\r\n            const index = this.nextInitializedTick(ticks, tick, lte).index;\r\n            const nextInitializedTick = Math.min(maximum, index);\r\n            return [nextInitializedTick, nextInitializedTick === index];\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=tickList.js.map","references":["/Users/luozhiwei/project/uniswap/v3-sdk/node_modules/jsbi/jsbi.d.ts","/Users/luozhiwei/project/uniswap/v3-sdk/node_modules/tiny-invariant/dist/tiny-invariant.d.ts","/Users/luozhiwei/project/uniswap/v3-sdk/src/entities/tick.ts","/Users/luozhiwei/project/uniswap/v3-sdk/src/internalConstants.ts","/Users/luozhiwei/project/uniswap/v3-sdk/src/utils/isSorted.ts"],"map":"{\"version\":3,\"file\":\"tickList.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/utils/tickList.ts\"],\"names\":[],\"mappings\":\"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\"}"}
