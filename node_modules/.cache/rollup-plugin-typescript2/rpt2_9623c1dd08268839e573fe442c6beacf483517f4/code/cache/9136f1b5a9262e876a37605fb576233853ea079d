{"code":"import { MaxUint256 } from '@uniswap/sdk-core';\r\nimport JSBI from 'jsbi';\r\nimport invariant from 'tiny-invariant';\r\nimport { ONE, ZERO } from '../internalConstants';\r\nimport { mostSignificantBit } from './mostSignificantBit';\r\nfunction mulShift(val, mulBy) {\r\n    return JSBI.signedRightShift(JSBI.multiply(val, JSBI.BigInt(mulBy)), JSBI.BigInt(128));\r\n}\r\nconst Q32 = JSBI.exponentiate(JSBI.BigInt(2), JSBI.BigInt(32));\r\nexport class TickMath {\r\n    /**\r\n     * Cannot be constructed.\r\n     */\r\n    constructor() { }\r\n    /**\r\n     * Returns the sqrt ratio as a Q64.96 for the given tick. The sqrt ratio is computed as sqrt(1.0001)^tick\r\n     * @param tick the tick for which to compute the sqrt ratio\r\n     */\r\n    static getSqrtRatioAtTick(tick) {\r\n        invariant(tick >= TickMath.MIN_TICK && tick <= TickMath.MAX_TICK && Number.isInteger(tick), 'TICK');\r\n        const absTick = tick < 0 ? tick * -1 : tick;\r\n        let ratio = (absTick & 0x1) != 0\r\n            ? JSBI.BigInt('0xfffcb933bd6fad37aa2d162d1a594001')\r\n            : JSBI.BigInt('0x100000000000000000000000000000000');\r\n        if ((absTick & 0x2) != 0)\r\n            ratio = mulShift(ratio, '0xfff97272373d413259a46990580e213a');\r\n        if ((absTick & 0x4) != 0)\r\n            ratio = mulShift(ratio, '0xfff2e50f5f656932ef12357cf3c7fdcc');\r\n        if ((absTick & 0x8) != 0)\r\n            ratio = mulShift(ratio, '0xffe5caca7e10e4e61c3624eaa0941cd0');\r\n        if ((absTick & 0x10) != 0)\r\n            ratio = mulShift(ratio, '0xffcb9843d60f6159c9db58835c926644');\r\n        if ((absTick & 0x20) != 0)\r\n            ratio = mulShift(ratio, '0xff973b41fa98c081472e6896dfb254c0');\r\n        if ((absTick & 0x40) != 0)\r\n            ratio = mulShift(ratio, '0xff2ea16466c96a3843ec78b326b52861');\r\n        if ((absTick & 0x80) != 0)\r\n            ratio = mulShift(ratio, '0xfe5dee046a99a2a811c461f1969c3053');\r\n        if ((absTick & 0x100) != 0)\r\n            ratio = mulShift(ratio, '0xfcbe86c7900a88aedcffc83b479aa3a4');\r\n        if ((absTick & 0x200) != 0)\r\n            ratio = mulShift(ratio, '0xf987a7253ac413176f2b074cf7815e54');\r\n        if ((absTick & 0x400) != 0)\r\n            ratio = mulShift(ratio, '0xf3392b0822b70005940c7a398e4b70f3');\r\n        if ((absTick & 0x800) != 0)\r\n            ratio = mulShift(ratio, '0xe7159475a2c29b7443b29c7fa6e889d9');\r\n        if ((absTick & 0x1000) != 0)\r\n            ratio = mulShift(ratio, '0xd097f3bdfd2022b8845ad8f792aa5825');\r\n        if ((absTick & 0x2000) != 0)\r\n            ratio = mulShift(ratio, '0xa9f746462d870fdf8a65dc1f90e061e5');\r\n        if ((absTick & 0x4000) != 0)\r\n            ratio = mulShift(ratio, '0x70d869a156d2a1b890bb3df62baf32f7');\r\n        if ((absTick & 0x8000) != 0)\r\n            ratio = mulShift(ratio, '0x31be135f97d08fd981231505542fcfa6');\r\n        if ((absTick & 0x10000) != 0)\r\n            ratio = mulShift(ratio, '0x9aa508b5b7a84e1c677de54f3e99bc9');\r\n        if ((absTick & 0x20000) != 0)\r\n            ratio = mulShift(ratio, '0x5d6af8dedb81196699c329225ee604');\r\n        if ((absTick & 0x40000) != 0)\r\n            ratio = mulShift(ratio, '0x2216e584f5fa1ea926041bedfe98');\r\n        if ((absTick & 0x80000) != 0)\r\n            ratio = mulShift(ratio, '0x48a170391f7dc42444e8fa2');\r\n        if (tick > 0)\r\n            ratio = JSBI.divide(MaxUint256, ratio);\r\n        // back to Q96\r\n        return JSBI.greaterThan(JSBI.remainder(ratio, Q32), ZERO)\r\n            ? JSBI.add(JSBI.divide(ratio, Q32), ONE)\r\n            : JSBI.divide(ratio, Q32);\r\n    }\r\n    /**\r\n     * Returns the tick corresponding to a given sqrt ratio, s.t. #getSqrtRatioAtTick(tick) <= sqrtRatioX96\r\n     * and #getSqrtRatioAtTick(tick + 1) > sqrtRatioX96\r\n     * @param sqrtRatioX96 the sqrt ratio as a Q64.96 for which to compute the tick\r\n     */\r\n    static getTickAtSqrtRatio(sqrtRatioX96) {\r\n        invariant(JSBI.greaterThanOrEqual(sqrtRatioX96, TickMath.MIN_SQRT_RATIO) &&\r\n            JSBI.lessThan(sqrtRatioX96, TickMath.MAX_SQRT_RATIO), 'SQRT_RATIO');\r\n        const sqrtRatioX128 = JSBI.leftShift(sqrtRatioX96, JSBI.BigInt(32));\r\n        const msb = mostSignificantBit(sqrtRatioX128);\r\n        let r;\r\n        if (JSBI.greaterThanOrEqual(JSBI.BigInt(msb), JSBI.BigInt(128))) {\r\n            r = JSBI.signedRightShift(sqrtRatioX128, JSBI.BigInt(msb - 127));\r\n        }\r\n        else {\r\n            r = JSBI.leftShift(sqrtRatioX128, JSBI.BigInt(127 - msb));\r\n        }\r\n        let log_2 = JSBI.leftShift(JSBI.subtract(JSBI.BigInt(msb), JSBI.BigInt(128)), JSBI.BigInt(64));\r\n        for (let i = 0; i < 14; i++) {\r\n            r = JSBI.signedRightShift(JSBI.multiply(r, r), JSBI.BigInt(127));\r\n            const f = JSBI.signedRightShift(r, JSBI.BigInt(128));\r\n            log_2 = JSBI.bitwiseOr(log_2, JSBI.leftShift(f, JSBI.BigInt(63 - i)));\r\n            r = JSBI.signedRightShift(r, f);\r\n        }\r\n        const log_sqrt10001 = JSBI.multiply(log_2, JSBI.BigInt('255738958999603826347141'));\r\n        const tickLow = JSBI.toNumber(JSBI.signedRightShift(JSBI.subtract(log_sqrt10001, JSBI.BigInt('3402992956809132418596140100660247210')), JSBI.BigInt(128)));\r\n        const tickHigh = JSBI.toNumber(JSBI.signedRightShift(JSBI.add(log_sqrt10001, JSBI.BigInt('291339464771989622907027621153398088495')), JSBI.BigInt(128)));\r\n        return tickLow === tickHigh\r\n            ? tickLow\r\n            : JSBI.lessThanOrEqual(TickMath.getSqrtRatioAtTick(tickHigh), sqrtRatioX96)\r\n                ? tickHigh\r\n                : tickLow;\r\n    }\r\n}\r\n/**\r\n * The minimum tick that can be used on any pool.\r\n */\r\nTickMath.MIN_TICK = -887272;\r\n/**\r\n * The maximum tick that can be used on any pool.\r\n */\r\nTickMath.MAX_TICK = -TickMath.MIN_TICK;\r\n/**\r\n * The sqrt ratio corresponding to the minimum tick that could be used on any pool.\r\n */\r\nTickMath.MIN_SQRT_RATIO = JSBI.BigInt('4295128739');\r\n/**\r\n * The sqrt ratio corresponding to the maximum tick that could be used on any pool.\r\n */\r\nTickMath.MAX_SQRT_RATIO = JSBI.BigInt('1461446703485210103287273052203988822378723970342');\r\n//# sourceMappingURL=tickMath.js.map","references":["/Users/luozhiwei/project/uniswap/v3-sdk/node_modules/@uniswap/sdk-core/dist/index.d.ts","/Users/luozhiwei/project/uniswap/v3-sdk/node_modules/jsbi/jsbi.d.ts","/Users/luozhiwei/project/uniswap/v3-sdk/node_modules/tiny-invariant/dist/tiny-invariant.d.ts","/Users/luozhiwei/project/uniswap/v3-sdk/src/internalConstants.ts","/Users/luozhiwei/project/uniswap/v3-sdk/src/utils/mostSignificantBit.ts"],"map":"{\"version\":3,\"file\":\"tickMath.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/utils/tickMath.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/luozhiwei/project/uniswap/v3-sdk/utils/tickMath.d.ts","writeByteOrderMark":false,"text":"import JSBI from 'jsbi';\r\nexport declare abstract class TickMath {\r\n    /**\r\n     * Cannot be constructed.\r\n     */\r\n    private constructor();\r\n    /**\r\n     * The minimum tick that can be used on any pool.\r\n     */\r\n    static MIN_TICK: number;\r\n    /**\r\n     * The maximum tick that can be used on any pool.\r\n     */\r\n    static MAX_TICK: number;\r\n    /**\r\n     * The sqrt ratio corresponding to the minimum tick that could be used on any pool.\r\n     */\r\n    static MIN_SQRT_RATIO: JSBI;\r\n    /**\r\n     * The sqrt ratio corresponding to the maximum tick that could be used on any pool.\r\n     */\r\n    static MAX_SQRT_RATIO: JSBI;\r\n    /**\r\n     * Returns the sqrt ratio as a Q64.96 for the given tick. The sqrt ratio is computed as sqrt(1.0001)^tick\r\n     * @param tick the tick for which to compute the sqrt ratio\r\n     */\r\n    static getSqrtRatioAtTick(tick: number): JSBI;\r\n    /**\r\n     * Returns the tick corresponding to a given sqrt ratio, s.t. #getSqrtRatioAtTick(tick) <= sqrtRatioX96\r\n     * and #getSqrtRatioAtTick(tick + 1) > sqrtRatioX96\r\n     * @param sqrtRatioX96 the sqrt ratio as a Q64.96 for which to compute the tick\r\n     */\r\n    static getTickAtSqrtRatio(sqrtRatioX96: JSBI): number;\r\n}\r\n"}}
